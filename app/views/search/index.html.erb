<body>
  <h1>Search Articles</h1>

  <%= form_tag('/search', method: 'post', id: 'searchForm') do %>
    <label for="searchInput">Search:</label>
    <%= text_field_tag 'title', nil, placeholder: 'Search articles...', id: 'searchInput' %>
    <%= submit_tag 'Search' %>
  <% end %>

  <ul id="search-results">
  </ul>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      var searchSegments = [];

      $('#searchInput').on('input', function() {
        var input = $(this).val().trim();

        $.ajax({
          type: 'POST',
          url: '/search',
          data: { query: input },
          success: function(response) {
            console.log(response);
            var resultsList = $('#search-results');
            resultsList.empty();

            if (response.length > 0) {
              response.forEach(function(result) {
                var listItem = $('<li>').text(result.title);
                resultsList.append(listItem);
              });
            } else {
              resultsList.append($('<li>').text("No results found"));
            }
          },
          error: function() {
            resultsList.empty();
            resultsList.append($('<li>').text("Error fetching results"));
          }
        });
      });

      $('#searchForm').on('submit', function(e) {
        e.preventDefault();
        var query = $('#searchInput').val().trim();
        $.ajax({
          type: 'POST',
          url: '/search',
          data: { query: query },
          success: function(response) {
            console.log(response);
          },
          error: function() {
            resultsList.empty();
            resultsList.append($('<li>').text("Error fetching results"));
          }
        });
      });
    });
  </script>
</body>